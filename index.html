<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lyrics Search</title>
</head>
<body>
  <div id="result"></div>

  <script>
    const API_KEY = 'e6d0cd0023b7ee562a97be33d3c5f524';
    const BASE_URL = 'https://api.musixmatch.com/ws/1.1/';

    function searchSongAndLyrics() {
      const urlParams = new URLSearchParams(window.location.search);
      const songName = urlParams.get('song');
      const artistName = urlParams.get('artist');

      if (!songName || !artistName) {
        displayResult({ error: 'Missing parameters: Please provide song and artist names in the URL.' });
      } else {
        fetchLyrics(songName, artistName);
      }
    }

    async function fetchLyrics(songName, artistName) {
      try {
        let trackId = null;

        const searchResponse = await fetch(
          `${BASE_URL}track.search?q_track=${encodeURIComponent(songName)}&q_artist=${encodeURIComponent(artistName)}&f_has_lyrics=1&apikey=${API_KEY}`
        );
        const searchData = await searchResponse.json();

        const trackList = searchData.message.body.track_list;

        if (trackList.length > 0) {
          trackId = trackList[0].track.track_id;
        } else {
          const allTracksResponse = await fetch(
            `${BASE_URL}track.search?q_artist=${encodeURIComponent(artistName)}&apikey=${API_KEY}`
          );
          const allTracksData = await allTracksResponse.json();

          const allTracks = allTracksData.message.body.track_list;

          if (allTracks.length > 0) {
            trackId = allTracks[0].track.track_id;
          }
        }

        if (trackId) {
          const lyricsResponse = await fetch(
            `${BASE_URL}track.lyrics.get?track_id=${trackId}&apikey=${API_KEY}`
          );
          const lyricsData = await lyricsResponse.json();

          let lyrics = lyricsData.message.body.lyrics.lyrics_body;
          const disclaimer = '******* This Lyrics is NOT for Commercial use *******';
          lyrics = lyrics.replace(disclaimer, '');

          const data = {
            artist_name: artistName,
            song: songName,
            lyrics: lyrics.trim()
          };

          displayResult(data);
        } else {
          displayResult({ error: 'No lyrics found for this song by this artist.' });
        }
      } catch (error) {
        console.error('Error:', error);
        displayResult({ error: 'An error occurred while fetching lyrics.' });
      }
    }

    function displayResult(result) {
      const resultDiv = document.getElementById('result');
      if (result.error) {
        resultDiv.innerText = result.error;
      } else {
        const artistName = document.createElement('p');
        artistName.textContent = `Artist: ${result.artist_name}`;

        const song = document.createElement('p');
        song.textContent = `Song: ${result.song}`;

        const lyrics = document.createElement('pre');
        lyrics.textContent = `Lyrics:\n${result.lyrics}`;

        resultDiv.appendChild(artistName);
        resultDiv.appendChild(song);
        resultDiv.appendChild(lyrics);
      }
    }

    searchSongAndLyrics();
  </script>
</body>
</html>
